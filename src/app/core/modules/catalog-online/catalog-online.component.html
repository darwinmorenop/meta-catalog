<div class="dashboard-container">
  <header class="dashboard-header">
    <div class="header-title-wrapper">
      <button mat-icon-button routerLink="/" class="back-button">
        <mat-icon>home</mat-icon>
      </button>
      <div class="header-content">
        <h1>Gestor de Catálogo Online</h1>
        <p class="subtitle">Sincronización con Facebook/Yanbal</p>
      </div>
    </div>
    <div class="header-actions">
      <button mat-raised-button (click)="openImportDialog()" color="primary">
        <mat-icon>upload_file</mat-icon>
        Importar Excel
      </button>
      <button mat-raised-button (click)="exportData()" [disabled]="products().length === 0" color="accent">
        <mat-icon>download</mat-icon>
        Exportar
      </button>
      <button mat-flat-button (click)="syncWithBackend()" [disabled]="isLoading()" color="primary" class="sync-button">
        <mat-icon *ngIf="!isLoading()">sync</mat-icon>
        <span *ngIf="isLoading()">Sincronizando...</span>
        <span *ngIf="!isLoading()">Sincronizar</span>
      </button>
    </div>
  </header>

  <div class="stats-grid">
    <mat-card class="stat-card">
      <mat-card-header>
        <mat-icon mat-card-avatar class="stat-icon products-icon">inventory_2</mat-icon>
        <mat-card-title>Productos</mat-card-title>
        <mat-card-subtitle>{{ fileName() || 'Sin archivo' }}</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <span class="stat-value">{{ products().length }}</span>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card" *ngIf="changes().length > 0">
      <mat-card-header>
        <mat-icon mat-card-avatar class="stat-icon active-icon">notification_important</mat-icon>
        <mat-card-title>Cambios Detectados</mat-card-title>
        <mat-card-subtitle>Pendientes de revisión</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div class="changes-content">
          <span class="stat-value">{{ changes().length }}</span>
          <button mat-stroked-button color="warn" (click)="viewChanges()">Ver Cambios</button>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <div class="actions-card-row">
    <mat-card class="actions-card">
      <mat-card-content>
        <div class="actions-toolbar">
          <button mat-button (click)="addProduct()" color="primary">
            <mat-icon>add</mat-icon> Agregar Producto
          </button>
          <button mat-button (click)="editProduct(selectedProduct()!)" [disabled]="!selectedProduct()" color="primary">
            <mat-icon>edit</mat-icon> Editar
          </button>
          <button mat-button (click)="deleteProduct(selectedProduct()!)" [disabled]="!selectedProduct()" color="warn">
            <mat-icon>delete</mat-icon> Eliminar
          </button>
          <div class="spacer"></div>
          <button mat-button (click)="clearData()" *ngIf="products().length > 0" color="warn">
            <mat-icon>clear_all</mat-icon> Limpiar Todo
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <mat-card class="table-card">
    <mat-card-content>
      <app-smart-table [data]="products()" [config]="tableConfig" (selectionChange)="selectedProduct.set($event)">
      </app-smart-table>

      <div class="empty-state" *ngIf="products().length === 0">
        <mat-icon class="empty-icon">cloud_upload</mat-icon>
        <p>Sube el archivo <code>base.xlsx</code> o agrega un producto nuevo para comenzar.</p>
      </div>
    </mat-card-content>
  </mat-card>
</div>