<div class="dialog-container">
  <div class="dialog-header">
    <div class="title-row">
      <mat-icon color="primary">{{ isViewMode ? 'visibility' : 'edit' }}</mat-icon>
      <h2>
        @if (isViewMode) { Ver Perfil }
        @else if (isEditMode) { Editar Perfil }
        @else { Crear Perfil }
      </h2>
    </div>
    <button mat-icon-button (click)="dialogRef.close()" class="close-button">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <mat-dialog-content class="dialog-content">
    <form [formGroup]="form" class="profile-form">
      <div class="form-grid">
        <mat-form-field appearance="outline">
          <mat-label>Nombre del Perfil</mat-label>
          <input matInput formControlName="name" placeholder="Ej: Administrador, Solo Lectura...">
          <mat-error *ngIf="form.get('name')?.hasError('required')">El nombre es obligatorio</mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Descripci칩n</mat-label>
          <textarea matInput formControlName="description" rows="2" placeholder="Describe brevemente el prop칩sito de este perfil..."></textarea>
        </mat-form-field>
      </div>
    </form>

    <div class="permissions-section">
      <div class="section-header">
        <h3>Permisos por Recurso</h3>
        @if (!isViewMode) {
          <div class="add-resource-row">
            <mat-form-field appearance="outline" class="resource-selector">
              <mat-label>A침adir Recurso</mat-label>
              <mat-select #resourceSelect (selectionChange)="addResource($event.value); resourceSelect.value = null">
                @for (res of unusedResources; track res) {
                  <mat-option [value]="res">{{ getResourceLabel(res) }}</mat-option>
                }
                @if (unusedResources.length === 0) {
                  <mat-option disabled>Todos los recursos a침adidos</mat-option>
                }
              </mat-select>
            </mat-form-field>
          </div>
        }
      </div>

      <div class="permissions-table-container">
        <app-smart-table
          [data]="tableData()"
          [config]="tableConfig"
          (view)="onViewResource($event)"
          (edit)="onEditResource($event)"
          (delete)="onDeleteResource($event)">
        </app-smart-table>
      </div>
    </div>
  </mat-dialog-content>

  <mat-dialog-actions align="end" class="dialog-actions">
    <button mat-button (click)="dialogRef.close()">{{ isViewMode ? 'Cerrar' : 'Cancelar' }}</button>
    @if (!isViewMode) {
      <button mat-flat-button color="primary" (click)="save()" [disabled]="form.invalid">
        <mat-icon>save</mat-icon>
        Guardar Perfil
      </button>
    }
  </mat-dialog-actions>
</div>
